---

title: åˆ†æç”µå­å•†åŠ¡ç½‘ç«™A/Bæµ‹è¯•çš„ç»“æœ
date: 2019-4-29 12:00:39
tags: æ•°æ®åˆ†æ

---


## ç›®å½•

- [ç®€ä»‹](#intro)
- [I - æ¦‚ç‡](#probability)
- [II - A/B æµ‹è¯•](#ab_test)
- [III - å›å½’](#regression)



### ç®€ä»‹

A/B æµ‹è¯•æ˜¯æ•°æ®åˆ†æå¸ˆå’Œæ•°æ®ç§‘å­¦å®¶éœ€è¦ç»å¸¸å®Œæˆçš„å·¥ä½œï¼Œéå¸¸é‡è¦ã€‚

æœ¬é¡¹ç›®è®¾å®šäº†ä¸€å®¶ç”µå­å•†åŠ¡ç½‘ç«™è¿è¡Œ A/B æµ‹è¯•çš„æƒ…å¢ƒã€‚ç›®æ ‡æ˜¯é€šè¿‡è¿™ä¸ªé¡¹ç›®æ¥å¸®åŠ©å…¬å¸åˆ†æå’Œå†³å®šä»–ä»¬æ˜¯å¦åº”è¯¥ä½¿ç”¨æ–°çš„é¡µé¢ï¼Œä¿ç•™æ—§çš„é¡µé¢ï¼Œæˆ–è€…åº”è¯¥å°†æµ‹è¯•æ—¶é—´å»¶é•¿ï¼Œä¹‹åå†åšå‡ºå†³å®šã€‚



#### I - æ¦‚ç‡

å…ˆå¯¼å…¥æ•°æ®ã€‚

In [1]:

```
import pandas as pd
import numpy as np
import random
import matplotlib.pyplot as plt
%matplotlib inline
#We are setting the seed to assure you get the same answers on quizzes as we set up
random.seed(42)
```



`1.` å¯¼å…¥ `ab_data.csv` æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ `df` ä¸­ã€‚ 

a. å¯¼å…¥æ•°æ®é›†ï¼ŒæŸ¥çœ‹å‰å‡ è¡Œæ•°æ®ï¼š

In [2]:

```
df=pd.read_csv('ab_data.csv')
df.head()
```

Out[2]:

|      | user_id |                  timestamp |     group | landing_page | converted |
| ---: | ------: | -------------------------: | --------: | -----------: | --------: |
|    0 |  851104 | 2017-01-21 22:11:48.556739 |   control |     old_page |         0 |
|    1 |  804228 | 2017-01-12 08:01:45.159739 |   control |     old_page |         0 |
|    2 |  661590 | 2017-01-11 16:55:06.154213 | treatment |     new_page |         0 |
|    3 |  853541 | 2017-01-08 18:28:03.143765 | treatment |     new_page |         0 |
|    4 |  864975 | 2017-01-21 01:52:26.210827 |   control |     old_page |         1 |



b. æŸ¥çœ‹æ•°æ®é›†çš„è¡Œæ•°ã€‚

In [3]:

```
df.shape[0]
```

Out[3]:

```
294478
```



c. æŸ¥çœ‹æ•°æ®é›†ä¸­çš„ç”¨æˆ·æ•°é‡ï¼ˆä¸åŒçš„user_idæ•°ï¼‰ã€‚

In [4]:

```
df.user_id.nunique()
```

Out[4]:

```
290584
```



d. è½¬åŒ–ç”¨æˆ·çš„å æ¯”ã€‚

In [5]:

```
df.converted.mean()
```

Out[5]:

```
0.11965919355605512
```



e. è®¡ç®—æ•°æ®ä¸­ `new_page` ä¸ `treatment` ä¸åŒ¹é…çš„æ¬¡æ•°ã€‚æç¤ºï¼šåœ¨ä¸€ä¸ªåˆç†çš„å®éªŒè®¾è®¡é‡Œï¼Œæ§åˆ¶ç»„(control) åº”è¯¥å¯¹åº”æ—§é¡µé¢(old_page)ï¼Œå®éªŒç»„(treatment) å¯¹åº”æ–°é¡µé¢(new_page)ã€‚

In [6]:

```
df.query("(group == 'control' and landing_page == 'new_page') or (group == 'treatment' and landing_page == 'old_page')")['user_id'].count() 
```

Out[6]:

```
3893
```



f. æ˜¯å¦æœ‰ä»»ä½•è¡Œç©ºç¼ºæ•°å€¼ï¼Ÿ

In [7]:

```
df.isnull().any()
```

Out[7]:

```
user_id         False
timestamp       False
group           False
landing_page    False
converted       False
dtype: bool
```



`2.` å¯¹äº **treatment** å’Œ **new_page** ä¸åŒ¹é…çš„è¡Œæˆ– **control** ä¸ **old_page** ä¸åŒ¹é…çš„è¡Œï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šè¯¥è¡Œæ˜¯å¦æ¥æ”¶åˆ°äº†æ–°é¡µé¢è¿˜æ˜¯æ—§é¡µé¢ã€‚å¦‚ä½•å¤„ç†è¿™äº›è¡Œï¼Ÿ

a. å°†æ–° dataframe å­˜å‚¨åœ¨ **df2** ä¸­ã€‚

In [8]:

```
df2 = df.query("(group == 'control' and landing_page == 'old_page') or (group == 'treatment' and landing_page == 'new_page')") 
```

In [9]:

```
# Double Check all of the correct rows were removed - this should be 0
df2[((df2['group'] == 'treatment') == (df2['landing_page'] == 'new_page')) == False].shape[0]
```

Out[9]:

```
0
```



`3.` æ ¹æ® **df2** æ¥å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚

a. **df2** ä¸­çš„ç”¨æˆ·æ•°é‡ï¼ˆä¸åŒçš„ **user_id**) ?

In [10]:

```
df2['user_id'].nunique()
```

Out[10]:

```
290584
```



b. **df2** ä¸­æœ‰ä¸€ä¸ªé‡å¤çš„ **user_id** ã€‚å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ

In [11]:

```
df2[df2['user_id'].duplicated()]['user_id']
```

Out[11]:

```
2893    773192
Name: user_id, dtype: int64
```



c. è¿™ä¸ªé‡å¤ **user_id** çš„è¡Œä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ

In [12]:

```
df2[df2['user_id'].duplicated()]
```

Out[12]:

|      | user_id |                  timestamp |     group | landing_page | converted |
| ---: | ------: | -------------------------: | --------: | -----------: | --------: |
| 2893 |  773192 | 2017-01-14 02:55:59.590927 | treatment |     new_page |         0 |



d. åˆ é™¤ä¸€è¡Œé‡å¤è¡Œï¼Œä½†ä»ç„¶å­˜å‚¨ dataframe ä¸º **df2**ã€‚

In [13]:

```
df2 = df2.drop_duplicates(subset='user_id')
```



`4.` ä½¿ç”¨ä¼˜åŒ–è¿‡çš„ **df2** æ¥å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚

a. ç”¨æˆ·æˆåŠŸè½¬åŒ–çš„æ•´ä½“æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿï¼ˆä¸åˆ†æ—§é¡µé¢æˆ–è€…æ–°é¡µé¢ï¼‰

In [14]:

```
df2['converted'].mean()
```

Out[14]:

```
0.11959708724499628
```



b. `control` ç»„ç”¨æˆ·çš„è½¬åŒ–ç‡æ˜¯å¤šå°‘ï¼Ÿ

In [15]:

```
df2[df2['group'] == 'control']['converted'].mean()
```

Out[15]:

```
0.1203863045004612
```



c. `treatment` ç»„ç”¨æˆ·çš„è½¬åŒ–ç‡æ˜¯å¤šå°‘ï¼Ÿ

In [16]:

```
df2[df2['group'] == 'treatment']['converted'].mean()
```

Out[16]:

```
0.11880806551510564
```



d. ä¸€ä¸ªç”¨æˆ·æ”¶åˆ°æ–°é¡µé¢çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ

In [17]:

```
len(df2[df2['landing_page'] == 'new_page'])/len(df2)
```

Out[17]:

```
0.5000619442226688
```



e. åˆ†æåˆ°è¿™é‡Œï¼Œæ˜¯å¦è®¤ä¸ºæœ‰è¶³å¤Ÿçš„æ•°æ®æ”¯æŒæ¥è¯æ˜æ—§é¡µé¢æˆ–è€…æ–°é¡µé¢å¯ä»¥å¸¦æ¥æ›´é«˜çš„è½¬åŒ–ç‡ï¼Ÿ



**ç”¨æˆ·æœ‰å¤§çº¦50%çš„æ¦‚ç‡æ¥æ”¶åˆ°æ–°é¡µé¢ä½œä¸ºç™»å½•é¡µé¢ï¼Œæ§åˆ¶ç»„å’Œå®éªŒç»„çš„ç”¨æˆ·æ•°é‡å¤§è‡´ç›¸åŒã€‚** **æ§åˆ¶ç»„æ¯”å®éªŒç»„çš„è½¬åŒ–ç‡ç•¥é«˜ï¼Œä½†å·®å¼‚å¾ˆå°ã€‚æ— è®ºå±äºå“ªä¸ªç»„ï¼Œå’Œç”¨æˆ·æˆåŠŸè½¬åŒ–çš„æ•´ä½“æ¦‚ç‡å·®å¼‚éƒ½ä¸å¤§ã€‚**

**æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ”¯æŒæ¥è¯æ˜æ—§é¡µé¢æˆ–è€…æ–°é¡µé¢å¯ä»¥å¸¦æ¥æ›´é«˜çš„è½¬åŒ–ç‡ã€‚**





### II - A/B æµ‹è¯•

å› ä¸ºæ¯ä¸ªäº‹ä»¶éƒ½å¯¹åº”æœ‰ä¸€ä¸ªæ—¶é—´è®°å½•ï¼ˆtime stamp æ—¶é—´æˆ³ï¼‰ï¼Œæ‰€ä»¥æŠ€æœ¯ä¸Šä½ å¯ä»¥å®ç°æ¯æ¬¡è§‚å¯Ÿéƒ½è¿ç»­è¿è¡Œå‡è®¾æ£€éªŒã€‚

ç„¶è€Œï¼Œé—®é¢˜çš„éš¾ç‚¹åœ¨äºï¼Œä»€ä¹ˆæ—¶å€™åœæ­¢ä½ çš„è¯•éªŒï¼šæ˜¯åœ¨å‘ç°å…¶ä¸­ä¸€ç»„çš„è¯•éªŒæ•ˆæœè¶³å¤Ÿå¥½æ—¶ç«‹å³åœæ­¢ï¼Ÿè¿˜æ˜¯åœ¨è¿™æ ·çš„è§‚å¯Ÿç»“æœåˆæŒç»­å‘ç”Ÿäº†ä¸€æ®µæ—¶é—´å†åœæ­¢ï¼Ÿéœ€è¦è¿è¡Œå¤šé•¿æ—¶é—´æ‰èƒ½ç¡®è®¤ä¸¤ä¸ªé¡µé¢æ²¡æœ‰å¸¦æ¥ç”¨æˆ·è½¬åŒ–ç‡çš„æ˜¾è‘—å·®å¼‚ï¼Ÿ



`1.` ç°åœ¨ï¼Œä½ éœ€è¦æ ¹æ®æˆ‘ä»¬æä¾›çš„æ•°æ®åšå‡ºå†³ç­–ï¼šä½ å‡è®¾æ—§é¡µé¢æ•ˆæœæ›´ä½³ï¼Œé™¤éåœ¨ä¸€ç±»é”™è¯¯åœ¨5%ä»¥å†…ï¼Œæ–°é¡µé¢è¢«è¯æ˜æ›´å¥½ã€‚åŸºäºæ­¤ï¼Œä½ çš„é›¶å‡è®¾å’Œå¤‡æ‹©å‡è®¾æ˜¯ä»€ä¹ˆï¼Ÿ ä½ å¯ä»¥ç”¨æ–‡å­—è¡¨è¿°æˆ–ç”¨ **poldpold** ä¸ **pnewpnew** ï¼ˆå³ï¼Œæ—§é¡µé¢è½¬åŒ–ç‡ä¸æ–°é¡µé¢è½¬åŒ–ç‡ï¼‰æ¥é™ˆè¿°ä½ çš„å‡è®¾ã€‚



é›¶å‡è®¾ï¼š**pnewpnew**-**poldpold**<=0ï¼Œ æ—§é¡µé¢æ•ˆæœæ¯”æ–°é¡µé¢æ•ˆæœå¥½æˆ–è€…å·®ä¸å¤š

å¤‡æ‹©å‡è®¾ï¼š**pnewpnew**-**poldpold**>0ï¼Œæ–°é¡µé¢æ•ˆæœæ¯”æ—§é¡µé¢æ•ˆæœå¥½



`2.` å‡å®šåœ¨é›¶å‡è®¾ä¸­ï¼Œä¸ç®¡æ˜¯æ–°é¡µé¢è¿˜æ˜¯æ—§é¡µé¢ï¼Œ pnewpnew ä¸ poldpold éƒ½æœ‰ç›¸åŒçš„è½¬åŒ–æˆåŠŸçš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ pnewpnew ä¸ poldpold æ˜¯ç›¸ç­‰çš„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å‡è®¾å®ƒä»¬éƒ½ç­‰äº**ab_data.csv** ä¸­çš„ **è½¬åŒ–ç‡(converted)**ã€‚ 

ç°åœ¨ï¼Œåœ¨æ–°æ—§é¡µé¢ä¸Šæ‰§è¡ŒæŠ½æ ·åˆ†å¸ƒï¼Œå¹¶è®¡ç®— **è½¬åŒ–(converted)** å·®å¼‚ã€‚è®°ä½ï¼Œæ¯ä¸ªé¡µé¢çš„æ ·æœ¬å¤§å°è¦ä¸ **ab_data.csv** ç›¸åŒã€‚è®¡ç®—é›¶å‡è®¾ä¸­10000æ¬¡è¿­ä»£è®¡ç®—çš„ä¼°è®¡å€¼ã€‚ 

a. åœ¨é›¶å‡è®¾ä¸­ï¼Œpnewpnew **è½¬åŒ–ç‡** æ˜¯å¤šå°‘ï¼Ÿ

In [18]:

```
p_new = df2['converted'].mean()
p_new
```

Out[18]:

```
0.11959708724499628
```



b. åœ¨é›¶å‡è®¾ä¸­ï¼Œ poldpold **è½¬åŒ–ç‡** æ˜¯å¤šå°‘ï¼Ÿ

In [19]:

```
p_old = df2['converted'].mean()
p_old
```

Out[19]:

```
0.11959708724499628
```



c. nnewnnew æ˜¯å¤šå°‘ï¼Ÿ

In [20]:

```
n_new = len(df2[df2['landing_page'] == 'new_page'])
n_new
```

Out[20]:

```
145310
```



d. noldnold?æ˜¯å¤šå°‘ï¼Ÿ

In [21]:

```
n_old=len(df2.query('landing_page=="old_page"'))
n_old
```

Out[21]:

```
145274
```



e. åœ¨é›¶å‡è®¾ä¸­ï¼Œä½¿ç”¨ pnewpnew ï¼ˆæ–°é¡µé¢çš„è½¬åŒ–ç‡ï¼‰æ¨¡æ‹Ÿ nnewnnew ä¸ªæ–°é¡µé¢çš„è½¬åŒ–ï¼Œå¹¶å°†è¿™äº› nnewnnew ä¸ª 1 å’Œ 0 å­˜å‚¨åœ¨ **new_page_converted** ä¸­ã€‚(å¯ä»¥ä½¿ç”¨[numpy.random.choice](https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html)ã€‚)

In [22]:

```
new_page_converted = np.random.choice(2, n_new, p=[p_new,1-p_new])
new_page_converted
```

Out[22]:

```
array([1, 1, 0, ..., 1, 1, 1])
```



f. åœ¨é›¶å‡è®¾ä¸­ï¼Œä½¿ç”¨ poldpold ï¼ˆæ—§é¡µé¢çš„è½¬åŒ–ç‡ï¼‰æ¨¡æ‹Ÿ noldnold ä¸ªæ—§é¡µé¢çš„è½¬åŒ–ï¼Œå¹¶å°†è¿™äº› noldnold ä¸ª 1 å’Œ 0 å­˜å‚¨åœ¨ **old_page_converted** ä¸­ã€‚

In [23]:

```
old_page_converted = np.random.choice(2, n_old, p=[p_old,1-p_old])
old_page_converted
```

Out[23]:

```
array([1, 1, 1, ..., 1, 1, 1])
```



g. æ ¹æ® e å’Œ fï¼Œè®¡ç®— pnewpnew å’Œ poldpold çš„å·®å¼‚å€¼ï¼ˆpnewpnew - poldpoldï¼‰ã€‚

In [24]:

```
p_diff = new_page_converted.mean() - old_page_converted.mean()
p_diff
```

Out[24]:

```
-0.0024480971790489248
```



h. ç”±äºå•ä¸ªæ•°å€¼ä¸èƒ½å½¢æˆåˆ†å¸ƒå›¾å½¢ï¼Œè¯·å‚è€ƒä»¥ä¸Ša-gçš„è¿‡ç¨‹ï¼Œæ¨¡æ‹Ÿ 10,000 ä¸ª pnewpnew ä¸ poldpold å·®å¼‚å€¼ï¼ˆpnewpnew - poldpoldï¼‰ï¼Œå°†è¿™ 10,000 ä¸ªå€¼å­˜å‚¨åœ¨ **p_diffs** ä¸­ã€‚

In [25]:

```
p_diffs=[]
for i in range(10000):
    new_page_converted = np.random.choice(2, n_new, p=[p_new,1-p_new])
    old_page_converted = np.random.choice(2, n_old, p=[p_old,1-p_old])
    p_diffs.append(new_page_converted.mean() - old_page_converted.mean())
p_diffs = np.array(p_diffs)
```



i. ç»˜åˆ¶ä¸€ä¸ª **p_diffs** åˆ†å¸ƒå›¾å½¢ã€‚å›¾å½¢è·Ÿä½ çš„é¢„æœŸç›¸ç¬¦å—ï¼Ÿ

In [26]:

```
plt.hist(p_diffs)
```

Out[26]:

```
(array([    8.,    82.,   388.,  1338.,  2453.,  2881.,  1947.,   701.,
          183.,    19.]),
 array([-0.00470562, -0.00380745, -0.00290927, -0.0020111 , -0.00111293,
        -0.00021475,  0.00068342,  0.00158159,  0.00247976,  0.00337794,
         0.00427611]),
 <a list of 10 Patch objects>)
```



![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYAAAAD8CAYAAAB+UHOxAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMS4wLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvpW3flQAAEkRJREFUeJzt3X+s3Xd93/Hna84PtkIbp7nJXNvMLnKlGmkL7CpkYn9ko8vPCoM0NGdasSiSOzWRQO00mfJHGB1SaNdSobKgtIlqOorJCgiLeEtNRlVVKkluaBLiuJkvSUou9mJ3pgGExOTw3h/n4+bYvr733Ot77rnm83xIX53veX8/3+/38/3E8svn+/mek1QVkqT+/L1Jd0CSNBkGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpwwASeqUASBJnVo0AJK8JsmjSZ5McijJf2r1rUkeSXIkyWeTXNbql7f3s237lqFjfaDVn01y07guSpK0uCz2TeAkAX6sqr6X5FLgz4H3Ab8CfL6q9iX5JPBkVd2T5JeBf1xV/z7JTuCdVfVvkmwHPgNcB/wU8GXgZ6rqlfOd+6qrrqotW7aswGVKUj8ef/zxv6mqqcXaXbJYgxokxPfa20vbUsC/BP5tq+8FPgTcA+xo6wB/DPxuC5EdwL6q+gHwfJJZBmHwF+c795YtW5iZmVmsi5KkIUn+epR2I80BJFmX5AngOHAQ+Abwt1V1qjWZAza29Y3AiwBt+8vATw7X59ln+Fy7k8wkmTlx4sQo3ZMkLcNIAVBVr1TVtcAmBv9q/9n5mrXXnGfb+epnn+veqpququmpqUU/wUiSlmlJTwFV1d8CfwpcD1yR5PQtpE3A0bY+B2wGaNt/Ajg5XJ9nH0nSKhvlKaCpJFe09b8P/BxwGPgK8K9bs13AF9v6/vaetv1/tXmE/cDO9pTQVmAb8OhKXYgkaWkWnQQGNgB7k6xjEBgPVNWXkjwD7Evyn4G/BO5r7e8D/rBN8p4EdgJU1aEkDwDPAKeAOxZ6AkiSNF6LPgY6SdPT0+VTQJK0NEker6rpxdr5TWBJ6pQBIEmdMgAkqVOjTAJLmseWPQ9O5Lwv3H3bRM6rHz1+ApCkThkAktQpA0CSOmUASFKnDABJ6pQBIEmdMgAkqVMGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpwwASeqUASBJnTIAJKlTBoAkdcoAkKROGQCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ1aNACSbE7ylSSHkxxK8r5W/1CSbyV5oi23Du3zgSSzSZ5NctNQ/eZWm02yZzyXJEkaxSUjtDkF/GpVfS3J64DHkxxs2z5WVf9luHGS7cBO4I3ATwFfTvIzbfMngH8FzAGPJdlfVc+sxIVIkpZm0QCoqmPAsbb+3SSHgY0L7LID2FdVPwCeTzILXNe2zVbVcwBJ9rW2BoAkTcCS5gCSbAHeBDzSSncmeSrJ/UnWt9pG4MWh3eZa7Xx1SdIEjBwASV4LfA54f1V9B7gHeANwLYNPCL91uuk8u9cC9bPPszvJTJKZEydOjNo9SdISjRQASS5l8Jf/p6vq8wBV9VJVvVJVPwR+j1dv88wBm4d23wQcXaB+hqq6t6qmq2p6ampqqdcjSRrRKE8BBbgPOFxVvz1U3zDU7J3A0219P7AzyeVJtgLbgEeBx4BtSbYmuYzBRPH+lbkMSdJSjfIU0FuBXwC+nuSJVvs14PYk1zK4jfMC8EsAVXUoyQMMJndPAXdU1SsASe4EHgLWAfdX1aEVvBZ1aMueByfdBemiNcpTQH/O/PfvDyywz0eAj8xTP7DQfpKk1eM3gSWpUwaAJHXKAJCkThkAktQpA0CSOmUASFKnDABJ6pQBIEmdMgAkqVMGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpwwASeqUASBJnTIAJKlTBoAkdcoAkKROGQCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUwaAJHXKAJCkTi0aAEk2J/lKksNJDiV5X6tfmeRgkiPtdX2rJ8nHk8wmeSrJm4eOtau1P5Jk1/guS5K0mFE+AZwCfrWqfha4HrgjyXZgD/BwVW0DHm7vAW4BtrVlN3APDAIDuAt4C3AdcNfp0JAkrb5FA6CqjlXV19r6d4HDwEZgB7C3NdsLvKOt7wA+VQNfBa5IsgG4CThYVSer6tvAQeDmFb0aSdLIljQHkGQL8CbgEeCaqjoGg5AArm7NNgIvDu0212rnq0uSJmDkAEjyWuBzwPur6jsLNZ2nVgvUzz7P7iQzSWZOnDgxavckSUs0UgAkuZTBX/6frqrPt/JL7dYO7fV4q88Bm4d23wQcXaB+hqq6t6qmq2p6ampqKdciSVqCUZ4CCnAfcLiqfnto037g9JM8u4AvDtXf3Z4Guh54ud0iegi4Mcn6Nvl7Y6tJkibgkhHavBX4BeDrSZ5otV8D7gYeSPJe4JvAu9q2A8CtwCzwfeA9AFV1MsmvA4+1dh+uqpMrchWSpCVL1Tm34deM6enpmpmZmXQ3tIZt2fPgpLvQlRfuvm3SXdAIkjxeVdOLtfObwJLUKQNAkjplAEhSpwwASeqUASBJnTIAJKlTBoAkdcoAkKROGQCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUwaAJHXKAJCkThkAktQpA0CSOmUASFKnDABJ6pQBIEmdMgAkqVMGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpxYNgCT3Jzme5Omh2oeSfCvJE225dWjbB5LMJnk2yU1D9ZtbbTbJnpW/FEnSUozyCeAPgJvnqX+sqq5tywGAJNuBncAb2z7/Ncm6JOuATwC3ANuB21tbSdKEXLJYg6r6syRbRjzeDmBfVf0AeD7JLHBd2zZbVc8BJNnX2j6z5B5LklbEhcwB3JnkqXaLaH2rbQReHGoz12rnq0uSJmS5AXAP8AbgWuAY8Futnnna1gL1cyTZnWQmycyJEyeW2T1J0mKWFQBV9VJVvVJVPwR+j1dv88wBm4eabgKOLlCf79j3VtV0VU1PTU0tp3uSpBEsKwCSbBh6+07g9BNC+4GdSS5PshXYBjwKPAZsS7I1yWUMJor3L7/bkqQLtegkcJLPADcAVyWZA+4CbkhyLYPbOC8AvwRQVYeSPMBgcvcUcEdVvdKOcyfwELAOuL+qDq341UiSRjbKU0C3z1O+b4H2HwE+Mk/9AHBgSb2TJI2N3wSWpE4ZAJLUKQNAkjplAEhSpwwASeqUASBJnTIAJKlTi34PQBrFlj0PTroLkpbITwCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUwaAJHXKAJCkThkAktQpA0CSOmUASFKnDABJ6pQBIEmdMgAkqVMGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpxYNgCT3Jzme5Omh2pVJDiY50l7Xt3qSfDzJbJKnkrx5aJ9drf2RJLvGczmSpFGN8gngD4Cbz6rtAR6uqm3Aw+09wC3AtrbsBu6BQWAAdwFvAa4D7jodGpKkyVg0AKrqz4CTZ5V3AHvb+l7gHUP1T9XAV4ErkmwAbgIOVtXJqvo2cJBzQ0WStIqWOwdwTVUdA2ivV7f6RuDFoXZzrXa+uiRpQlZ6Ejjz1GqB+rkHSHYnmUkyc+LEiRXtnCTpVcsNgJfarR3a6/FWnwM2D7XbBBxdoH6Oqrq3qqaranpqamqZ3ZMkLWa5AbAfOP0kzy7gi0P1d7enga4HXm63iB4Cbkyyvk3+3thqkqQJuWSxBkk+A9wAXJVkjsHTPHcDDyR5L/BN4F2t+QHgVmAW+D7wHoCqOpnk14HHWrsPV9XZE8uSpFW0aABU1e3n2fS2edoWcMd5jnM/cP+SeidJGhu/CSxJnTIAJKlTBoAkdcoAkKROGQCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUwaAJHXKAJCkThkAktQpA0CSOmUASFKnDABJ6tSi/0MYSTpty54HJ3LeF+6+bSLn/VHnJwBJ6pQBIEmdMgAkqVMGgCR1ygCQpE4ZAJLUKQNAkjplAEhSpwwASeqUASBJnbqgAEjyQpKvJ3kiyUyrXZnkYJIj7XV9qyfJx5PMJnkqyZtX4gIkScuzEp8A/kVVXVtV0+39HuDhqtoGPNzeA9wCbGvLbuCeFTi3JGmZxnELaAewt63vBd4xVP9UDXwVuCLJhjGcX5I0ggsNgAL+JMnjSXa32jVVdQygvV7d6huBF4f2nWs1SdIEXOjPQb+1qo4muRo4mOSvFmibeWp1TqNBkOwGeP3rX3+B3ZMknc8FfQKoqqPt9TjwBeA64KXTt3ba6/HWfA7YPLT7JuDoPMe8t6qmq2p6amrqQronSVrAsgMgyY8led3pdeBG4GlgP7CrNdsFfLGt7wfe3Z4Guh54+fStIknS6ruQW0DXAF9Icvo4f1RV/zPJY8ADSd4LfBN4V2t/ALgVmAW+D7znAs4tSbpAyw6AqnoO+Cfz1P8v8LZ56gXcsdzzSZJWlt8ElqROGQCS1CkDQJI6daHfA9Aas2XPg5PugqSLhJ8AJKlTBoAkdcoAkKROGQCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUwaAJHXKAJCkThkAktQpA0CSOmUASFKn/DloSWveJH/m/IW7b5vYucfNTwCS1CkDQJI6ZQBIUqcMAEnqlAEgSZ0yACSpUz4GOgaTfGRNkkblJwBJ6tSqB0CSm5M8m2Q2yZ7VPr8kaWBVAyDJOuATwC3AduD2JNtXsw+SpIHVngO4DpitqucAkuwDdgDPrHI/JGkkk5rTW42foFjtANgIvDj0fg54y7hO5mSsJJ3fagdA5qnVGQ2S3cDu9vZ7SZ4de6+W7yrgbybdiTXCsTiT43Emx+NMi45HPnpBx/9HozRa7QCYAzYPvd8EHB1uUFX3AveuZqeWK8lMVU1Puh9rgWNxJsfjTI7HmdbKeKz2U0CPAduSbE1yGbAT2L/KfZAkscqfAKrqVJI7gYeAdcD9VXVoNfsgSRpY9W8CV9UB4MBqn3dMLopbVavEsTiT43Emx+NMa2I8UlWLt5Ik/cjxpyAkqVMGwFmSXJnkYJIj7XX9edrtam2OJNk1VP+nSb7efuri40ly1n7/IUkluWrc17ISxjUeSX4zyV8leSrJF5JcsVrXtByL/YRJksuTfLZtfyTJlqFtH2j1Z5PcNOox16qVHoskm5N8JcnhJIeSvG/1rubCjePPRtu2LslfJvnS2DpfVS5DC/AbwJ62vgf46DxtrgSea6/r2/r6tu1R4J8x+M7D/wBuGdpvM4MJ8L8Grpr0tU5yPIAbgUva+kfnO+5aWRg8sPAN4KeBy4Ange1ntfll4JNtfSfw2ba+vbW/HNjajrNulGOuxWVMY7EBeHNr8zrgf18MYzGu8Rja71eAPwK+NK7++wngXDuAvW19L/COedrcBBysqpNV9W3gIHBzkg3Aj1fVX9Tgv+Cnztr/Y8B/5Kwvv61xYxmPqvqTqjrV9v8qg++ErFV/9xMmVfX/gNM/YTJseJz+GHhb+7SzA9hXVT+oqueB2Xa8UY65Fq34WFTVsar6GkBVfRc4zOBXAy4G4/izQZJNwG3A74+z8wbAua6pqmMA7fXqedrM95MWG9syN0+dJG8HvlVVT46j02M0lvE4yy8y+HSwVp3v+uZt04LtZeAnF9h3lGOuReMYi7/Tbo+8CXhkBfs8TuMaj99h8I/FH658l1/V5f8QJsmXgX84z6YPjnqIeWp1vnqSf9COfeOIx19Vqz0eZ537g8Ap4NMjnmsSFr2OBdqcrz7fP74uhk+G4xiLwU7Ja4HPAe+vqu8su4era8XHI8nPA8er6vEkN1xg/xbUZQBU1c+db1uSl5JsqKpj7RbG8XmazQE3DL3fBPxpq286q34UeAODe3xPtjnQTcDXklxXVf/nAi5lRUxgPE4fexfw88Db2i2itWrRnzAZajOX5BLgJ4CTi+y72DHXorGMRZJLGfzl/+mq+vx4uj4W4xiPtwNvT3Ir8Brgx5P8t6r6dyve+0lPoqy1BfhNzpz0/I152lwJPM9gwnN9W7+ybXsMuJ5XJz1vnWf/F7h4JoHHMh7AzQx+Bnxq0tc4whhcwmBieyuvTvS98aw2d3DmRN8Dbf2NnDnR9xyDicNFj7kWlzGNRRjMD/3OpK9vLYzHWfvewBgngSc+gGttYXBv7mHgSHs9/RfZNPD7Q+1+kcGkzSzwnqH6NPA0gxn936V92e6sc1xMATCW8WjtXgSeaMsnJ32ti4zDrQyeTvkG8MFW+zDw9rb+GuC/t+t6FPjpoX0/2PZ7ljOfCjvnmBfDstJjAfxzBrdEnhr683DOP5zW6jKOPxtD28caAH4TWJI65VNAktQpA0CSOmUASFKnDABJ6pQBIEmdMgAkqVMGgCR1ygCQpE79f7IVkjYZ/1GmAAAAAElFTkSuQmCC )



j. **p_diffs**åˆ—è¡¨çš„æ•°å€¼ä¸­ï¼Œæœ‰å¤šå°‘æ¯”ä¾‹çš„æ•°å€¼ä¼šå¤§äº **ab_data.csv** ä¸­è§‚å¯Ÿåˆ°çš„å®é™…**è½¬åŒ–ç‡å·®å¼‚** ï¼Ÿ

In [27]:

```
actual_new_mean = df2[df2['group'] == 'treatment']['converted'].mean()
actual_old_mean = df2[df2['group'] == 'control']['converted'].mean()
actual_diff = actual_new_mean -  actual_old_mean
actual_diff
```

Out[27]:

```
-0.0015782389853555567
```

In [28]:

```
(p_diffs > actual_diff).mean()
```

Out[28]:

```
0.90290000000000004
```



k. ç”¨æ–‡å­—è§£é‡Šä¸€ä¸‹ä½ åˆšæ‰åœ¨ **j.** ä¸­è®¡ç®—å‡ºæ¥çš„ç»“æœã€‚åœ¨æ•°æ®ç ”ç©¶ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ä»€ä¹ˆï¼Ÿ æ ¹æ®è¿™ä¸ªæ•°å€¼ï¼Œè¯·åˆ¤æ–­æ–°æ—§é¡µé¢çš„è½¬åŒ–ç‡æ˜¯å¦æœ‰æ˜¾è‘—å·®å¼‚ã€‚



**ä¸Šè¿°è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ¨¡æ‹Ÿäº† 10,000 ä¸ª ğ‘ğ‘›ğ‘’ğ‘¤ ä¸ ğ‘ğ‘œğ‘™ğ‘‘ çš„å·®å¼‚å€¼ï¼Œå¹¶ä»¥æ­¤ç»˜åˆ¶å›¾å½¢ã€‚æ ¹æ®æ‰€æä¾›æ•°æ®è®¡ç®—å‡ºå®é™…è½¬åŒ–ç‡å·®å¼‚ï¼Œæ¯”è¾ƒæ¨¡æ‹Ÿäº†10,000ä¸ªè½¬åŒ–ç‡çš„å·®å¼‚å€¼å’Œå®é™…è½¬åŒ–ç‡å·®å¼‚ã€‚è¿™ä¸ªå€¼æ˜¯ p å€¼ã€‚å¤§çº¦æœ‰90%çš„æ¦‚ç‡å¤§äº ab_data.csv ä¸­è§‚å¯Ÿåˆ°çš„å®é™…è½¬åŒ–ç‡å·®å¼‚ï¼ŒPå€¼éå¸¸å¤§è¯´æ˜æ— æ³•æ‹’ç»é›¶å‡è®¾ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„è¯æ®æ”¯æŒæ–°æ—§é¡µé¢çš„è½¬åŒ–ç‡æœ‰æ˜¾è‘—å·®å¼‚ã€‚**



l. æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå†…ç½®ç¨‹åº ï¼ˆbuilt-inï¼‰æ¥å®ç°ç±»ä¼¼çš„ç»“æœã€‚ä½¿ç”¨å†…ç½®ç¨‹åºå¯èƒ½å¾ˆå®¹æ˜“å°±èƒ½å–å¾—ç»“æœï¼Œä½†ä¸Šé¢çš„å†…å®¹ä»ç„¶å¾ˆé‡è¦ï¼Œå®ƒå¯ä»¥è®­ç»ƒä½ å…·æœ‰æ­£ç¡®çš„æ•°æ®ç»Ÿè®¡æ€ç»´ã€‚å¡«å†™ä¸‹é¢çš„å†…å®¹æ¥è®¡ç®—æ¯ä¸ªé¡µé¢çš„è½¬åŒ–æ¬¡æ•°ï¼Œä»¥åŠæ”¶åˆ°æ¯ä¸ªé¡µé¢çš„ç”¨æˆ·æ•°ã€‚è®¡ç®—æ–°æ—§é¡µé¢å‡ºç°çš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸­ `n_old` ä¸ `n_new` åˆ†åˆ«å‡ºç°çš„è¡Œæ•°ã€‚

In [42]:

```
import statsmodels.api as sm

convert_old = len(df2[(df2['landing_page'] == 'old_page') & (df2['converted'] == 1)])
convert_new = len(df2[(df2['landing_page'] == 'new_page') & (df2['converted'] == 1)])
n_old = len(df2[df2['landing_page'] == 'old_page'])
n_new = len(df2[df2['landing_page'] == 'new_page'])
```



m. ç°åœ¨ä½¿ç”¨ `stats.proportions_ztest` æ¥è®¡ç®—ä½ çš„ z-score (ä»€ä¹ˆæ˜¯ [z-score](https://www.khanacademy.org/math/statistics-probability/modeling-distributions-of-data/z-scores/a/z-scores-review)) ä¸ p-valueã€‚[è¿™é‡Œ](http://knowledgetack.com/python/statsmodels/proportions_ztest/) çš„èµ„æ–™å¯ä»¥æä¾›é¢å¤–ä¿¡æ¯ã€‚

In [30]:

```
z_score,p_value=sm.stats.proportions_ztest([convert_old, convert_new], [n_old, n_new], alternative='smaller')
z_score,p_value
```

Out[30]:

```
(1.3109241984234394, 0.90505831275902449)
```

In [31]:

```
import scipy.stats as st
st.norm.cdf(z_score)
```

Out[31]:

```
0.90505831275902449
```

In [32]:

```
st.norm.ppf(1-(0.05))
```

Out[32]:

```
1.6448536269514722
```



n. æ ¹æ®ä¸Šé¢˜ç®—å‡ºçš„ z-score å’Œ p-valueï¼Œä½ è®¤ä¸ºæ–°æ—§é¡µé¢çš„è½¬åŒ–ç‡æ˜¯å¦æœ‰åŒºåˆ«ï¼Ÿå®ƒä»¬ä¸ **j.** ä¸ **k.** é—®é¢˜ä¸­çš„ç»“æœä¸€è‡´å—ï¼Ÿ



**z-score 1.31 å°äºä¸´ç•Œå€¼ 1.64ï¼Œæ— æ³•æ‹’ç»é›¶å‡è®¾ã€‚P å€¼ 0.905 ä¸å°äº 0.05ï¼Œæ— æ³•æ‹’ç»é›¶å‡è®¾ã€‚ä» P å€¼çœ‹ï¼Œè¿™ä¸ªæ¦‚ç‡å¤§çº¦æœ‰90%ã€‚å› æ­¤ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„è¯æ®æ”¯æŒæ–°æ—§é¡µé¢çš„è½¬åŒ–ç‡æœ‰æ˜¾è‘—å·®å¼‚ï¼Œä¸ j. ä¸ k. é—®é¢˜ä¸­çš„ç»“æœä¸€è‡´ã€‚**





### III - å›å½’åˆ†ææ³•ä¹‹ä¸€

`1.` åœ¨æœ€åä¸€éƒ¨åˆ†ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ï¼Œä½ åœ¨ä¹‹å‰çš„A / Bæµ‹è¯•ä¸­è·å¾—çš„ç»“æœä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œå›å½’æ¥è·å–ã€‚



a. æ—¢ç„¶æ¯è¡Œçš„å€¼æ˜¯è½¬åŒ–æˆ–ä¸è½¬åŒ–ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥æ‰§è¡Œå“ªç§ç±»å‹çš„å›å½’ï¼Ÿ



**é€»è¾‘å›å½’**



b. ç›®æ ‡æ˜¯ä½¿ç”¨ **statsmodels** æ¥æ‹Ÿåˆä½ åœ¨ **a.** ä¸­æŒ‡å®šçš„å›å½’æ¨¡å‹ï¼Œä»¥æŸ¥çœ‹ç”¨æˆ·æ”¶åˆ°çš„ä¸åŒé¡µé¢æ˜¯å¦å­˜åœ¨æ˜¾è‘—çš„è½¬åŒ–å·®å¼‚ã€‚ä½†æ˜¯ï¼Œé¦–å…ˆï¼Œä½ éœ€è¦ä¸ºè¿™ä¸ªæˆªè·åˆ›å»ºä¸€ä¸ªåˆ—ï¼ˆ åŸæ–‡ï¼šcolumnï¼‰ ï¼Œå¹¶ä¸ºæ¯ä¸ªç”¨æˆ·æ”¶åˆ°çš„é¡µé¢åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå˜é‡åˆ—ã€‚æ·»åŠ ä¸€ä¸ª **æˆªè·** åˆ—ï¼Œä¸€ä¸ª **ab_page** åˆ—ï¼Œå½“ç”¨æˆ·æ¥æ”¶ **treatment** æ—¶ä¸º1ï¼Œ **control** æ—¶ä¸º0ã€‚

In [33]:

```
df2[['new_page','old_page']] = pd.get_dummies(df2['landing_page'])
df2['intercept'] = 1
df2['ab_page'] = pd.get_dummies(df['group']) ['treatment']
df2.head()
```

Out[33]:

|      | user_id |                  timestamp |     group | landing_page | converted | new_page | old_page | intercept | ab_page |
| ---: | ------: | -------------------------: | --------: | -----------: | --------: | -------: | -------: | --------: | ------: |
|    0 |  851104 | 2017-01-21 22:11:48.556739 |   control |     old_page |         0 |        0 |        1 |         1 |       0 |
|    1 |  804228 | 2017-01-12 08:01:45.159739 |   control |     old_page |         0 |        0 |        1 |         1 |       0 |
|    2 |  661590 | 2017-01-11 16:55:06.154213 | treatment |     new_page |         0 |        1 |        0 |         1 |       1 |
|    3 |  853541 | 2017-01-08 18:28:03.143765 | treatment |     new_page |         0 |        1 |        0 |         1 |       1 |
|    4 |  864975 | 2017-01-21 01:52:26.210827 |   control |     old_page |         1 |        0 |        1 |         1 |       0 |



c. ä½¿ç”¨ **statsmodels** å¯¼å…¥ä½ çš„å›å½’æ¨¡å‹ã€‚ å®ä¾‹åŒ–è¯¥æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ä½ åœ¨ **b.** ä¸­åˆ›å»ºçš„2ä¸ªåˆ—æ¥æ‹Ÿåˆè¯¥æ¨¡å‹ï¼Œç”¨æ¥é¢„æµ‹ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¼šå‘ç”Ÿè½¬åŒ–ã€‚

In [34]:

```
logit_mod=sm.Logit(df2['converted'],df2[['intercept','ab_page']])
result=logit_mod.fit()
```



```
Optimization terminated successfully.
         Current function value: 0.366118
         Iterations 6
```



d. è¯·åœ¨ä¸‹æ–¹æä¾›ä½ çš„æ¨¡å‹æ‘˜è¦ï¼Œå¹¶æ ¹æ®éœ€è¦ä½¿ç”¨å®ƒæ¥å›ç­”ä¸‹é¢çš„é—®é¢˜ã€‚

In [35]:

```
result.summary()
```

Out[35]:

| Dep. Variable: |        converted | No. Observations: | 290584      |
| -------------: | ---------------: | ----------------- | ----------- |
|         Model: |            Logit | Df Residuals:     | 290582      |
|        Method: |              MLE | Df Model:         | 1           |
|          Date: | Sun, 17 Mar 2019 | Pseudo R-squ.:    | 8.077e-06   |
|          Time: |         11:48:05 | Log-Likelihood:   | -1.0639e+05 |
|     converged: |             True | LL-Null:          | -1.0639e+05 |
|                |                  | LLR p-value:      | 0.1899      |

|           |    coef | std err |        z | P>\|z\| | [0.025 | 0.975] |
| --------: | ------: | ------: | -------: | ------: | -----: | ------ |
| intercept | -1.9888 |   0.008 | -246.669 |   0.000 | -2.005 | -1.973 |
|   ab_page | -0.0150 |   0.011 |   -1.311 |   0.190 | -0.037 | 0.007  |



e. ä¸ **ab_page** å…³è”çš„ p-å€¼æ˜¯å¤šå°‘ï¼Ÿ ä¸ºä»€ä¹ˆå®ƒä¸ä½ åœ¨ **II** ä¸­å‘ç°çš„ç»“æœä¸åŒï¼Ÿ

**æç¤º**: ä¸ä½ çš„å›å½’æ¨¡å‹ç›¸å…³çš„é›¶å‡è®¾ä¸å¤‡æ‹©å‡è®¾åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬å¦‚ä½•ä¸ **Part II** ä¸­çš„é›¶å‡è®¾å’Œå¤‡æ‹©å‡è®¾åšæ¯”è¾ƒï¼Ÿ



**ab_page çš„ p å€¼ä¸º0.190ã€‚**

åœ¨å›å½’æ¨¡å‹ä¸­æ˜¯åŒä¾§æ£€éªŒï¼Œ Part II ä¸­æ˜¯å•ä¾§æ£€éªŒã€‚è¿™ä¸ªæ£€éªŒä¸­æ£€éªŒçš„æ˜¯ä¸ç›¸ç­‰ï¼Œ Part IIä¸­æ£€éªŒçš„æ˜¯å¤§äºæˆ–ç­‰äºã€‚

åœ¨è¿™ä¸ªå›å½’æ¨¡å‹ä¸­

é›¶å‡è®¾ï¼š**pnewpnew**=**poldpold**

å¤‡æ‹©å‡è®¾ï¼š**pnewpnew**â‰ **poldpold**



f. ç°åœ¨ï¼Œä½ ä¸€å®šåœ¨è€ƒè™‘å…¶ä»–å¯èƒ½å½±å“ç”¨æˆ·æ˜¯å¦å‘ç”Ÿè½¬åŒ–çš„å› ç´ ã€‚è®¨è®ºä¸ºä»€ä¹ˆè€ƒè™‘å°†å…¶ä»–å› ç´ æ·»åŠ åˆ°å›å½’æ¨¡å‹ä¸­æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ã€‚åœ¨å›å½’æ¨¡å‹ä¸­æ·»åŠ é™„åŠ é¡¹æœ‰ä»€ä¹ˆå¼Šç«¯å—ï¼Ÿ

**å¯èƒ½æœ‰å¤šç§å› ç´ ä¼šå½±å“åˆ°è½¬æ¢ç‡ï¼Œæ¯”å¦‚æ—¶é—´æˆ³å˜é‡ï¼Œå¯ä»¥æ£€æŸ¥è½¬æ¢ç‡æ˜¯å¦å–å†³äºå½“å¤©çš„ç‰¹å®šæ—¶é—´æˆ–ç”¨æˆ·æµè§ˆç½‘ç«™çš„ç‰¹å®šæ—¶é—´ã€‚å°†å…¶ä»–å› ç´ æ·»åŠ åˆ°å›å½’æ¨¡å‹ä¸­ï¼Œä¹Ÿè®¸å¯ä»¥åšå‡ºæ›´å‡†ç¡®çš„å†³ç­–ã€‚**

**å¼Šç«¯æ˜¯ï¼Œå½“ä¸€äº›å› ç´ ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œå½±å“ä¼šæ¶ˆå¤±æˆ–è€…é€†è½¬ï¼Œå¦‚è¯¾ç¨‹ä¸­æåŠçš„è¾›æ™®æ£®æ‚–è®ºã€‚**

**å¦‚æœæ·»åŠ çš„è‡ªå˜é‡å½¼æ­¤ç›¸å…³ï¼Œä¼šå‡ºç°å¤šé‡å…±çº¿æ€§ï¼Œå½±å“æ¨¡å‹ã€‚å¤šé‡å…±çº¿æ€§ä¼šå¯¼è‡´ç®€å•çº¿æ€§å›å½’ç³»æ•°åç¦»æˆ‘ä»¬æƒ³è¦çš„æ–¹å‘ã€‚**



g. ç°åœ¨ï¼Œé™¤äº†æµ‹è¯•ä¸åŒé¡µé¢çš„è½¬åŒ–ç‡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–ä¹‹å¤–ï¼Œè¿˜è¦æ ¹æ®ç”¨æˆ·å±…ä½çš„å›½å®¶æˆ–åœ°åŒºæ·»åŠ ä¸€ä¸ª effect é¡¹ã€‚ä½ éœ€è¦å¯¼å…¥ **countries.csv** æ•°æ®é›†ï¼Œå¹¶å°†æ•°æ®é›†åˆå¹¶åœ¨é€‚å½“çš„è¡Œä¸Šã€‚ [è¿™é‡Œ](https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.join.html) æ˜¯é“¾æ¥è¡¨æ ¼çš„æ–‡æ¡£ã€‚

è¿™ä¸ªå›½å®¶é¡¹å¯¹è½¬åŒ–æœ‰å½±å“å—ï¼Ÿä¸è¦å¿˜è®°ä¸ºè¿™äº›å›½å®¶çš„åˆ—åˆ›å»ºè™šæ‹Ÿå˜é‡â€”â€” **æç¤º: ä½ å°†éœ€è¦ä¸ºè¿™ä¸‰ä¸ªè™šæ‹Ÿå˜é‡å¢åŠ ä¸¤åˆ—ã€‚** æä¾›ç»Ÿè®¡è¾“å‡ºï¼Œå¹¶ä¹¦é¢å›ç­”è¿™ä¸ªé—®é¢˜ã€‚

In [36]:

```
df_countries=pd.read_csv('countries.csv')
df_countries.head(1)
```

Out[36]:

|      | user_id | country |
| ---: | ------: | ------: |
|    0 |  834778 |      UK |

In [37]:

```
df_countries['country'].unique()
```

Out[37]:

```
array(['UK', 'US', 'CA'], dtype=object)
```

In [38]:

```
df3 = df_countries.set_index('user_id').join(df2.set_index('user_id'), how='inner')
```

In [39]:

```
df3['intercept'] = 1
df3[['UK','US']] = pd.get_dummies(df3['country'])[['UK','US']]
df3.head()
```

Out[39]:

|         | country |                  timestamp |     group | landing_page | converted | new_page | old_page | intercept | ab_page |   UK |   US |
| ------: | ------: | -------------------------: | --------: | -----------: | --------: | -------: | -------: | --------: | ------: | ---: | ---: |
| user_id |         |                            |           |              |           |          |          |           |         |      |      |
|  834778 |      UK | 2017-01-14 23:08:43.304998 |   control |     old_page |         0 |        0 |        1 |         1 |       0 |    1 |    0 |
|  928468 |      US | 2017-01-23 14:44:16.387854 | treatment |     new_page |         0 |        1 |        0 |         1 |       1 |    0 |    1 |
|  822059 |      UK | 2017-01-16 14:04:14.719771 | treatment |     new_page |         1 |        1 |        0 |         1 |       1 |    1 |    0 |
|  711597 |      UK | 2017-01-22 03:14:24.763511 |   control |     old_page |         0 |        0 |        1 |         1 |       0 |    1 |    0 |
|  710616 |      UK | 2017-01-16 13:14:44.000513 | treatment |     new_page |         0 |        1 |        0 |         1 |       1 |    1 |    0 |

In [40]:

```
logit_mod_3 = sm.Logit(df3['converted'], df3[['intercept', 'UK', 'US']])
result_3 = logit_mod_3.fit()
result_3.summary()
```



```
Optimization terminated successfully.
         Current function value: 0.366116
         Iterations 6
```

Out[40]:

| Dep. Variable: |        converted | No. Observations: | 290584      |
| -------------: | ---------------: | ----------------- | ----------- |
|         Model: |            Logit | Df Residuals:     | 290581      |
|        Method: |              MLE | Df Model:         | 2           |
|          Date: | Sun, 17 Mar 2019 | Pseudo R-squ.:    | 1.521e-05   |
|          Time: |         11:48:06 | Log-Likelihood:   | -1.0639e+05 |
|     converged: |             True | LL-Null:          | -1.0639e+05 |
|                |                  | LLR p-value:      | 0.1984      |

|           |    coef | std err |       z | P>\|z\| | [0.025 | 0.975] |
| --------: | ------: | ------: | ------: | ------: | -----: | ------ |
| intercept | -2.0375 |   0.026 | -78.364 |   0.000 | -2.088 | -1.987 |
|        UK |  0.0507 |   0.028 |   1.786 |   0.074 | -0.005 | 0.106  |
|        US |  0.0408 |   0.027 |   1.518 |   0.129 | -0.012 | 0.093  |



**ä» p å€¼æ¥çœ‹ï¼Œåªæœ‰ intercept çš„ P å€¼ç­‰äº 0ï¼Œå›½å®¶é¡¹å¯¹è½¬åŒ–ç‡çš„å½±å“å¹¶ä¸æ˜¾è‘—ï¼Œè¯´æ˜å›½å®¶é¡¹å¯¹è½¬åŒ–ç‡æ²¡æœ‰å¤šå¤§å½±å“ã€‚**



h. è™½ç„¶ä½ ç°åœ¨å·²ç»æŸ¥çœ‹äº†å›½å®¶ä¸é¡µé¢åœ¨è½¬åŒ–ç‡ä¸Šçš„ä¸ªä½“æ€§å› ç´ ï¼Œä½†ç°åœ¨æˆ‘ä»¬è¦æŸ¥çœ‹é¡µé¢ä¸å›½å®¶/åœ°åŒºä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œæµ‹è¯•å…¶æ˜¯å¦ä¼šå¯¹è½¬åŒ–äº§ç”Ÿé‡å¤§å½±å“ã€‚åˆ›å»ºå¿…è¦çš„é™„åŠ åˆ—ï¼Œå¹¶æ‹Ÿåˆä¸€ä¸ªæ–°çš„æ¨¡å‹ã€‚

æä¾›ä½ çš„æ‘˜è¦ç»“æœï¼Œä»¥åŠæ ¹æ®ç»“æœå¾—å‡ºçš„ç»“è®ºã€‚

**æç¤ºï¼šé¡µé¢ä¸å›½å®¶/åœ°åŒºçš„ç›¸äº’ä½œç”¨**

```
df3['new_CA'] = df3['new_page'] * df3['CA']
df3['new_UK'] = df3['new_page'] * df3['UK']
```

In [41]:

```
df3['new_UK'] = df3['new_page'] * df3['UK']
df3['new_US'] = df3['new_page'] * df3['US']
logit_mod_new = sm.Logit(df3.converted,df3[['intercept', 'new_page', 'UK', 'US', 'new_UK', 'new_US']])
result_new = logit_mod_new.fit()
result_new.summary()
```



```
Optimization terminated successfully.
         Current function value: 0.366109
         Iterations 6
```

Out[41]:

| Dep. Variable: |        converted | No. Observations: | 290584      |
| -------------: | ---------------: | ----------------- | ----------- |
|         Model: |            Logit | Df Residuals:     | 290578      |
|        Method: |              MLE | Df Model:         | 5           |
|          Date: | Sun, 17 Mar 2019 | Pseudo R-squ.:    | 3.482e-05   |
|          Time: |         11:48:07 | Log-Likelihood:   | -1.0639e+05 |
|     converged: |             True | LL-Null:          | -1.0639e+05 |
|                |                  | LLR p-value:      | 0.1920      |

|           |    coef | std err |       z | P>\|z\| | [0.025 | 0.975] |
| --------: | ------: | ------: | ------: | ------: | -----: | ------ |
| intercept | -2.0040 |   0.036 | -55.008 |   0.000 | -2.075 | -1.933 |
|  new_page | -0.0674 |   0.052 |  -1.297 |   0.195 | -0.169 | 0.034  |
|        UK |  0.0118 |   0.040 |   0.296 |   0.767 | -0.066 | 0.090  |
|        US |  0.0175 |   0.038 |   0.465 |   0.642 | -0.056 | 0.091  |
|    new_UK |  0.0783 |   0.057 |   1.378 |   0.168 | -0.033 | 0.190  |
|    new_US |  0.0469 |   0.054 |   0.872 |   0.383 | -0.059 | 0.152  |



**ä» p å€¼æ¥çœ‹ï¼Œåªæœ‰ intercept çš„ P å€¼ç­‰äº 0ï¼Œé¡µé¢ä¸å›½å®¶/åœ°åŒºä¹‹é—´çš„ç›¸äº’ä½œç”¨å¯¹è½¬åŒ–ç‡çš„å½±å“å¹¶ä¸æ˜¾è‘—ã€‚**

**è¿™åªæ˜¯ä¾æ®æ ·æœ¬å¾—å‡ºçš„ç»“è®ºï¼Œè¿˜æœ‰å…¶ä»–æ–¹é¢çš„å› ç´ å¯ä»¥è€ƒè™‘ã€‚**





## æ€»ç»“

ä»è½¬åŒ–ç‡æ¥çœ‹ï¼Œæ–°æ—§é¡µé¢å¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ã€‚ä¸æ¨èè¿™ä¸ªæ–°é¡µé¢ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶å®ƒå› ç´ åšç›¸å…³æµ‹è¯•ã€‚



## å‚è€ƒèµ„æ–™

- pandas.DataFrame.duplicated https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.duplicated.html

- pandas.DataFrame.drop_duplicates https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop_duplicates.html

- è¿”å›DataFrameæˆ–è€…arrayçš„è¡Œæ•° [http://sofasofa.io/forum_main_post.php?postid=1000472](http://sofasofa.io/forum_main_post.php?postid=1000472)

- Convert Z-score (Z-value, standard score) to p-value for normal distribution in Python https://stackoverflow.com/questions/3496656/convert-z-score-z-value-standard-score-to-p-value-for-normal-distribution-in

- pandas.get_dummies [http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.get_dummies.html](http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.get_dummies.html)

   